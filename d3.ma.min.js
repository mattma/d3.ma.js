/*! 
 	d3.ma.js - v0.1.0
 	Author: Matt Ma (matt@mattmadesign.com) 
 	Date: 2013-10-09
*/
!function(){"use strict";var a=window.d3,b=window.d3.ma,c=a.ma={};c.noConflict=function(){return window.d3ma=b,c},c.assert=function(a,b){if(!a)throw new Error("[d3.ma] "+b)},c.assert(a,"d3.js is required"),c.assert("string"==typeof a.version&&a.version.match(/^3/),"d3.js version 3 is required"),c.version="0.1.0",a.ma.windowSize=function(){var a={width:640,height:480};return document.body&&document.body.offsetWidth&&(a.width=document.body.offsetWidth,a.height=document.body.offsetHeight),"CSS1Compat"==document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(a.width=document.documentElement.offsetWidth,a.height=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(a.width=window.innerWidth,a.height=window.innerHeight),a},a.ma.Color=function(){var b=a.scale.category20().range();return function(a,c){return a.color||b[c%b.length]}},a.ma.calcTextWidth=function(b){if(b instanceof a.selection){var c=parseInt(b.style("font-size").replace("px","")),d=b.text().length;return.5*d*c}return 0},a.ma.each=function(a,b,c){if(null!=a){var d={},e=Array.prototype.forEach;if(e&&a.forEach===e)a.forEach(b,c);else if(a.length===+a.length){for(var f=0,g=a.length;g>f;f++)if(b.call(c,a[f],f,a)===d)return}else for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h)&&b.call(c,a[h],h,a)===d)return}},a.ma.onResize=function(a,b){var c=window.onresize;window.onresize=function(d){"function"==typeof c&&c.call(b||this,d),a.call(b||this,d)}},a.ma.resize=function(b){b="[object Array]"===Object.prototype.toString.call(b)?b:Array.prototype.slice.call(arguments),b.length&&a.ma.each(b,function(b){a.ma.onResize(b._resize,b)})},a.ma.reloadResize=function(b){if(b="[object Array]"===Object.prototype.toString.call(b)?b:Array.prototype.slice.call(arguments),b.length){var c={width:a.ma.windowSize().width,height:a.ma.windowSize().height};a.ma.each(b,function(a){a._resize.call(a||this),a._redraw(c)})}},a.ma.$=function(a,b){function c(a){return null!=a&&a.nodeType==a.DOCUMENT_NODE}var d,b=b||document,e=Array.prototype.slice,f=/^\.([\w-]+)$/,g=/^[\w-]+$/,h=/^#([\w-]*)$/;return c(b)&&h.test(a)?(d=b.getElementById(RegExp.$1))?[d]:[]:1!==b.nodeType&&9!==b.nodeType?[]:e.call(f.test(a)?b.getElementsByClassName(RegExp.$1):g.test(a)?b.getElementsByTagName(a):b.querySelectorAll(a))},a.ma.$$=function(b,c){var d=a.ma.$(b,c);return d[0]},a.ma.tooltip=function(a){var b={},a=a||b;return b.show=function(c,d,e,f){var g=document.createElement("div");g.className="d3maTooltip "+(f?f:"");var h=e||document.getElementsByTagName("body")[0];b!==a&&(h=a[0][0].parentNode.parentElement),g.innerHTML=d,g.style.left=0,g.style.top=0,g.style.opacity=0,h.appendChild(g);var i=c[0],j=c[1];return g.style.left=i+"px",g.style.top=j+"px",g.style.opacity=1,g.style.position="absolute",g.style.pointerEvents="none",b},b.close=function(){for(var a=document.getElementsByClassName("d3maTooltip"),c=[];a.length;)c.push(a[0]),a[0].style.transitionDelay="0 !important",a[0].style.opacity=0,a[0].className="d3maTooltip-pending-removal";return setTimeout(function(){for(;c.length;){var a=c.pop();a.parentNode.removeChild(a)}},500),b},b},a.ma.zoom=function(){var a={};return a},a.ma.container=function(b){function c(a,b){r.attr("transform","translate("+a+","+b+")")}function d(a,b,c){p.attr({width:a,height:b,x:-c,y:-1}),r.attr("clip-path","url(#"+n+")")}var e,f,g=a.select(b),h={top:30,right:10,bottom:20,left:40},i=a.ma.$$(b).clientWidth||g[0][0].clientWidth||document.body.clientWidth||960,j=a.ma.$$(b).clientHeight||g[0][0].clientHeight||window.innerHeight||540,k=g.append("svg"),l=Math.floor(1e3*Math.random()),m=k.append("defs"),n="clip-"+l,o=m.append("clipPath").attr("id",n),p=o.append("rect"),q="d3ma-"+l,r=k.append("g").classed("canvas",!0).attr({"class":"canvas",id:q}),s="xMidYMid",t=i/j,e=k.canvasW=function(a,b){return arguments.length?(b&&(a=parseInt(a)-h.left-h.right),r.attr("width",a),k):+r.attr("width")},f=k.canvasH=function(a,b){return arguments.length?(b&&(a=parseInt(a)-h.top-h.bottom),r.attr("height",a),k):+r.attr("height")};return k.box=function(a,b){var g=k.margin();if(!arguments.length)return{containerWidth:+e()+ +g.left+ +g.right,containerHeight:+f()+ +g.top+ +g.bottom};var h=b?b:a;return e(a,!0),f(h,!0),k.attr({width:a,height:h,viewBox:"0 0 "+a+" "+h,preserveAspectRatio:s}),t=a/h,i=a,j=h,c(g.left,g.top),d(a,h,g.left),k},k.margin=function(a){return arguments.length?(h.top="undefined"!=typeof a.top?a.top:h.top,h.right="undefined"!=typeof a.right?a.right:h.right,h.bottom="undefined"!=typeof a.bottom?a.bottom:h.bottom,h.left="undefined"!=typeof a.left?a.left:h.left,k.box(i,j),k):h},k.ratio=function(a){return arguments.length?(s=a,k.attr("preserveAspectRatio",a),k):s},k.canvas=function(){return k.select("g")},k.info=function(){var a=k.margin(),c=k.box();return{marginTop:a.top,marginRight:a.right,marginBottom:a.bottom,marginLeft:a.left,containerW:c.containerWidth,containerH:c.containerHeight,canvasW:e(),canvasH:f(),id:"#"+q,cid:"#"+n,parentNode:b}},k.resize=function(){return a.ma.onResize(function(){var b=a.ma.windowSize().width;if(i>b)k.attr({width:b,height:Math.round(b/t)});else{var c=+k.attr("width");i!==c&&k.attr({width:i,height:j})}}),k},k.box(i,j),k},a.chart("Clip",{initialize:function(){var a=this.base.append("defs"),b=Math.floor(1e3*Math.random());this.width=this.base.attr("width")||0,this.height=this.base.attr("height")||0,this.x=0,this.y=0,this.clipPath=a.append("clipPath"),this.rect=this.clipPath.append("rect"),this.cid="clip-"+b,this.clipPath.attr("id",this.cid),this.rect.attr({width:this.width,height:this.height,x:this.x,y:this.y})},id:function(a){return 0===arguments.length?this.cid:(this.cid=a,this.clipPath.attr("id",a),this)},url:function(){return"url(#"+this.id()+")"},_width:function(a){return 0===arguments.length?this.width:(this.width=a,this.rect.attr("width",a),this)},_height:function(a){return 0===arguments.length?this.height:(this.height=a,this.rect.attr("height",a),this)},box:function(a,b){return 0===arguments.length?{width:this.width,height:this.height}:(this._width(a),1===arguments.length?this._height(a):this._height(b),this)},xy:function(a,b){return 0===arguments.length?{x:this.x,y:this.y}:(this.x=a,this.y=1===arguments.length?a:b,this.rect.attr({x:this.x,y:this.y}),this)}}),a.chart("Scale",{initialize:function(a){if(a=a||{},!a.info)throw new Error("Container Info {info: containerInfo} is absolultely required when an instance is created");var b=a.x||"linear",c=a.y||"linear";this._x=b,this._y=c,this.width=a.width||a.info.canvasW||this.base.attr("width")||1,this.width=+this.width,this.height=a.height||a.info.canvasH||this.base.attr("height")||1,this.height=+this.height,this.info=a.info,this.xScale=this._scale(b),this.yScale=this._scale(c),this._switchXScale(b,this.width),this._switchYScale(c,this.height)},_switchXScale:function(a,b){switch(a){case"linear":this.xScale.range([0,b]);break;case"ordinal":this.xScale.rangeRoundBands([0,b],.1)}},_switchYScale:function(a,b){switch(a){case"linear":this.yScale.range([b,0]);break;case"ordinal":this.yScale.rangeRoundBands([b,0],.1)}},_scale:function(b){switch(b){case"linear":return a.scale.linear();case"ordinal":return a.scale.ordinal();case"log":return a.scale.log();case"pow":return a.scale.pow();case"sqrt":return a.scale.sqrt();case"identity":return a.scale.identity();case"quantile":return a.scale.quantile();case"quantize":return a.scale.quantize();case"threshold":return a.scale.threshold();case"time":return a.time.scale();default:return a.scale.linear()}}}),a.chart("Scale").extend("Base",{initialize:function(b){b=b||{},this.box(this.width,this.height),this.dispatch=a.dispatch("d3maMouseenter","d3maMouseout","d3maOnWindowResize","d3maOffWindowResize","d3maSingleWindowResize")},w:function(a){return 0===arguments.length?this.width:(this.width=a,this.base.attr("width",this.width),this)},h:function(a){return 0===arguments.length?this.height:(this.height=a,this.base.attr("height",this.height),this)},box:function(a,b){return arguments.length?(this.w(a),this.h(b?b:a),this):{width:this.width,height:this.height}},_bindMouseEnterOutEvents:function(b,c){var b=b||this;c.on("mouseenter",function(c,d){a.select(this).classed("hover",!0);var e={};b.onDataMouseenter&&(e=b.onDataMouseenter(c,d,b)),b.dispatch.d3maMouseenter(e)}),c.on("mouseout",function(c,d){a.select(this).classed("hover",!1);var e={};b.onDataMouseout&&(e=b.onDataMouseout(c,d,b)),b.dispatch.d3maMouseout(e)})},_resize:function(){var b=this.info,c=a.ma.$$(b.parentNode).offsetLeft+b.marginLeft+b.marginRight,d=a.ma.$$(b.parentNode).offsetTop+b.marginTop+b.marginBottom,e=a.ma.windowSize().width-c,f=a.ma.windowSize().height-d;if(e<b.containerW||f<b.containerH){var g={width:e<b.containerW?e:b.containerW,height:f<b.containerH?f:b.containerH};this.dispatch.d3maOnWindowResize(g)}else{var h={width:b.canvasW,height:b.canvasH},i={width:b.containerW,height:b.containerH};this.dispatch.d3maOnWindowResize(i),this.dispatch.d3maOffWindowResize(h)}},_onWindowResize:function(a,b){var c=this;this.dispatch.on("d3maOnWindowResize",function(d){c._redraw(d,a,b)}),this.dispatch.on("d3maOffWindowResize",function(d){c._unbind(d,a,b)})},_redraw:function(a,b,c){var d=this.info,e=a.width-d.marginLeft-d.marginRight,f=a.height-d.marginTop-d.marginBottom;this._updateScale(e,f),this.dispatch.d3maSingleWindowResize(b,c),this.update&&this.update(e,f,b,c)},_unbind:function(a,b,c){var d=this.info,e=+this.base.attr("width"),f=+this.base.attr("height"),g=d.canvasW,h=d.canvasH;(e!==g||f!==h)&&(this._updateScale(g,h),this.update&&this.update(g,h,b,c))},_updateScale:function(a,b){this._switchXScale(this._x,a),this._switchYScale(this._y,b),this.box(a,b)}}),a.chart("Base").extend("Axis",{initialize:function(b){b=b||{},this.guide=b.guide||!1,this.ticksOnResize=b.ticksOnResize||!1,this.xAxis=a.svg.axis().scale(this.xScale).orient("bottom"),this.yAxis=a.svg.axis().scale(this.yScale).orient("left"),this.guide&&(this.xAxis.tickPadding(5).tickSize(-this.height,0,6),this.yAxis.tickPadding(5).tickSize(-this.width,0,6)),this.xAxisG=this.base.append("g"),this.xAxisG.attr({"class":"x axis"}),this.xPos(),this.yAxisG=this.base.append("g"),this.yAxisG.attr({"class":"y axis"}),this.yPos()},transform:function(a){return this.onDataBind&&this.onDataBind(),this.xAxisG.call(this.xAxis),this.yAxisG.call(this.yAxis),this._onWindowResize(),a},xPos:function(a){var a=a?a:this.height;return this.xAxisG.attr({transform:"translate(0,"+a+")"}),this},yPos:function(a){return a&&this.yAxisG.attr({transform:"translate("+a+" , 0)"}),this},_update:function(a,b){this.xAxisG.attr({transform:"translate(0,"+b+")"}),this.ticksOnResize&&this._redrawTicksOnResize(),this.xAxisG.call(this.xAxis),this.yAxisG.call(this.yAxis)},_redrawTicksOnResize:function(){var a=this.xScale.range(),b=this.yScale.range();"ordinal"!==this._x&&this.xAxis.ticks(Math.abs(a[1]-a[0])/100),"ordinal"!==this._y&&this.yAxis.ticks(Math.abs(b[1]-b[0])/100)},xLabel:function(a,b,c){var d=this.info,e=b+d.marginLeft,f=c-d.marginBottom;return this.xAxisG.append("text").classed("label",!0).attr({x:e||d.marginLeft-15,y:f||0,transform:"translate("+this.info.marginLeft+","+this.info.marginBottom+")"}).text(a),this},yLabel:function(a,b,c){var d=this.info,e=-b+d.marginTop-15,f=Math.abs(c-d.marginLeft)-5;return this.yAxisG.append("text").classed("label",!0).attr({x:e||-15,y:f||15,transform:"rotate(-90) translate("+-this.info.marginTop+","+-this.info.marginLeft+")"}).text(a),this}}),a.chart("Base").extend("Bars",{initialize:function(a){a=a||{};var b=this;this.layer("bars",this.base,{dataBind:function(a){var b=this.chart();return b.onDataBind&&b.onDataBind(b),this.selectAll(".group").data(a)},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),this.append("g").classed("group",!0).append("rect")},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this),a._onWindowResize(a,this),b._bindMouseEnterOutEvents(a,this),this.style("opacity",1e-6)},"enter:transition":function(){return this.chart(),this.duration(1e3).style("opacity",.8)},"exit:transition":function(){return this.chart(),this.duration(400).style("opacity",1e-6).remove()}}})}}),a.chart("Base").extend("Line",{initialize:function(b){b=b||{},this.layer("line",this.base,{dataBind:function(c){var d=this.chart();return d.line=a.svg.line(),d.dispatch.on("d3maSingleWindowResize",function(a,b){b.attr({d:a.line})}),d.line.x(function(a){return d.xScale(a.x)}).y(function(a){return d.yScale(a.y)}),d.onDataBind&&d.onDataBind(d,c,b.data?b.data:void 0),this.selectAll("path").data([c])},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),this.append("path").classed("line",!0)},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this),a._onWindowResize(a,this),this.attr({d:a.line}).style("opacity",1e-6)},"enter:transition":function(){return this.chart(),this.duration(1e3).style("opacity",1)}}})}}),a.chart("Base").extend("Area",{initialize:function(b){b=b||{},this.layer("area",this.base,{dataBind:function(c){var d=this.chart();return d.area=a.svg.area(),d.dispatch.on("d3maSingleWindowResize",function(a,b){b.attr({d:a.area})}),d.area.x(function(a){return d.xScale(a.x)}).y1(function(a){return d.yScale(a.y)}).y0(d.yScale(0)),d.onDataBind&&d.onDataBind(d,c,b.data?b.data:void 0),this.selectAll("path").data([c])},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),this.append("path").classed("area",!0)},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this),a._onWindowResize(a,this),this.attr({d:a.area}).style("opacity",1e-6)},"enter:transition":function(){return this.chart(),this.duration(1e3).style("opacity",1)}}})}}),a.chart("Base").extend("Circle",{initialize:function(a){a=a||{};var b=this,c=a.showOnHover||!1;this.layer("circle",this.base,{dataBind:function(a){var b=this.chart();return b.onDataBind&&b.onDataBind(b),this.classed("dotHover",c?!0:!1).selectAll("circle").data(a)},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),this.append("circle")},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this),a._onWindowResize(a,this),b._bindMouseEnterOutEvents(a,this)}}})}})}();