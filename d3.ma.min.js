/*! 
 	d3.ma.js - v0.1.0
 	Author: Matt Ma (matt@mattmadesign.com) 
 	Date: 2014-03-03
*/
!function(){"use strict";var a=window.d3,b=window.d3.ma,c=a.ma={};c.noConflict=function(){return window.d3ma=b,c},c.assert=function(a,b){if(!a)throw new Error("[d3.ma] "+b)},c.assert(a,"d3.js is required"),c.assert("string"==typeof a.version&&a.version.match(/^3/),"d3.js version 3 is required"),c.version="0.1.0",a.ma.windowSize=function(){var a={width:640,height:480};return document.body&&document.body.offsetWidth&&(a.width=document.body.offsetWidth,a.height=document.body.offsetHeight),"CSS1Compat"==document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(a.width=document.documentElement.offsetWidth,a.height=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(a.width=window.innerWidth,a.height=window.innerHeight),a},a.ma.Color=function(){var b=a.scale.category20().range();return function(a,c){return a.color||b[c%b.length]}},a.ma.calcTextWidth=function(b){if(b instanceof a.selection){var c=parseInt(b.style("font-size").replace("px","")),d=b.text().length;return.5*d*c}return 0},a.ma.each=function(a,b,c){if(null!=a){var d={},e=Array.prototype.forEach;if(e&&a.forEach===e)a.forEach(b,c);else if(a.length===+a.length){for(var f=0,g=a.length;g>f;f++)if(b.call(c,a[f],f,a)===d)return}else for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h)&&b.call(c,a[h],h,a)===d)return}},a.ma.onResize=function(a,b){return function(c){a.call(b||this,c)}},a.ma.resize=function(b){b="[object Array]"===Object.prototype.toString.call(b)?b:Array.prototype.slice.call(arguments);var c=[];return b.length&&a.ma.each(b,function(b){c.push(a.ma.onResize(b._resize,b))}),c},a.ma.reloadResize=function(b){if(b="[object Array]"===Object.prototype.toString.call(b)?b:Array.prototype.slice.call(arguments),b.length){var c={width:a.ma.windowSize().width,height:a.ma.windowSize().height};a.ma.each(b,function(a){a._resize.call(a||this),a._redraw(c)})}},a.ma.$=function(a,b){function c(a){return null!=a&&a.nodeType==a.DOCUMENT_NODE}var d,b=b||document,e=Array.prototype.slice,f=/^\.([\w-]+)$/,g=/^[\w-]+$/,h=/^#([\w-]*)$/;return c(b)&&h.test(a)?(d=b.getElementById(RegExp.$1))?[d]:[]:1!==b.nodeType&&9!==b.nodeType?[]:e.call(f.test(a)?b.getElementsByClassName(RegExp.$1):g.test(a)?b.getElementsByTagName(a):b.querySelectorAll(a))},a.ma.$$=function(b,c){var d=a.ma.$(b,c);return d[0]},a.ma.tooltip=function(a){var b={},a=a||b;return b.show=function(c,d,e,f){var g=document.createElement("div");g.className="d3maTooltip "+(f?f:"");var h=e||document.getElementsByTagName("body")[0];b!==a&&(h=a[0][0].parentNode.parentElement),g.innerHTML=d,g.style.left=0,g.style.top=0,g.style.opacity=0,h.appendChild(g);var i=c[0],j=c[1];return g.style.left=i+"px",g.style.top=j+"px",g.style.opacity=1,g.style.position="absolute",g.style.pointerEvents="none",b},b.close=function(){for(var a=document.getElementsByClassName("d3maTooltip"),c=[];a.length;)c.push(a[0]),a[0].style.transitionDelay="0 !important",a[0].style.opacity=0,a[0].className="d3maTooltip-pending-removal";return setTimeout(function(){for(;c.length;){var a=c.pop();a.parentNode.removeChild(a)}},500),b},b},a.ma.zoom=function(){var a={};return a},a.ma.container=function(b,c){function d(a,b){s.attr("transform","translate("+a+","+b+")")}function e(a,b,c){q.attr({width:a,height:b,x:-c,y:-1}),s.attr("clip-path","url(#"+o+")")}var f,g,h=c?a.select(c).select(b):a.select(b),i={top:30,right:10,bottom:20,left:40},j=c?a.ma.$$(c+" "+b).clientWidth:a.ma.$$(b).clientWidth||h[0][0].clientWidth||document.body.clientWidth||960,k=c?a.ma.$$(c+" "+b).clientHeight:a.ma.$$(b).clientHeight||h[0][0].clientHeight||window.innerHeight||540,l=h.append("svg"),m=Math.floor(1e3*Math.random()),n=l.append("defs"),o="clip-"+m,p=n.append("clipPath").attr("id",o),q=p.append("rect"),r="d3ma-"+m,s=l.append("g").classed("canvas",!0).attr({"class":"canvas",id:r}),t="xMidYMid",u=j/k,f=l.canvasW=function(a,b){return arguments.length?(b&&(a=parseInt(a)-i.left-i.right),s.attr("width",a),l):+s.attr("width")},g=l.canvasH=function(a,b){return arguments.length?(b&&(a=parseInt(a)-i.top-i.bottom),s.attr("height",a),l):+s.attr("height")};return l.box=function(a,b){var c=l.margin();if(!arguments.length)return{containerWidth:+f()+ +c.left+ +c.right,containerHeight:+g()+ +c.top+ +c.bottom};var h=b?b:a;return f(a,!0),g(h,!0),l.attr({width:a,height:h,viewBox:"0 0 "+a+" "+h,preserveAspectRatio:t}),u=a/h,j=a,k=h,d(c.left,c.top),e(a,h,c.left),l},l.margin=function(a){return arguments.length?(i.top="undefined"!=typeof a.top?a.top:i.top,i.right="undefined"!=typeof a.right?a.right:i.right,i.bottom="undefined"!=typeof a.bottom?a.bottom:i.bottom,i.left="undefined"!=typeof a.left?a.left:i.left,l.box(j,k),l):i},l.ratio=function(a){return arguments.length?(t=a,l.attr("preserveAspectRatio",a),l):t},l.canvas=function(){return l.select("g")},l.info=function(){var a=l.margin(),c=l.box();return{marginTop:a.top,marginRight:a.right,marginBottom:a.bottom,marginLeft:a.left,containerW:c.containerWidth,containerH:c.containerHeight,canvasW:f(),canvasH:g(),id:"#"+r,cid:"#"+o,parentNode:b}},l.resize=function(){return a.ma.onResize(function(){var b=a.ma.windowSize().width;if(j>b)l.attr({width:b,height:Math.round(b/u)});else{var c=+l.attr("width");j!==c&&l.attr({width:j,height:k})}}),l},l.fluid=function(){var b=l.info(),c=a.ma.$$(b.parentNode);return c.setAttribute("data-fluid","responsive"),l},l.box(j,k),l},a.chart("Clip",{initialize:function(){var a=this.base.append("defs"),b=Math.floor(1e3*Math.random());this.width=this.base.attr("width")||0,this.height=this.base.attr("height")||0,this.x=0,this.y=0,this.clipPath=a.append("clipPath"),this.rect=this.clipPath.append("rect"),this.cid="clip-"+b,this.clipPath.attr("id",this.cid),this.rect.attr({width:this.width,height:this.height,x:this.x,y:this.y})},id:function(a){return 0===arguments.length?this.cid:(this.cid=a,this.clipPath.attr("id",a),this)},url:function(){return"url(#"+this.id()+")"},_width:function(a){return 0===arguments.length?this.width:(this.width=a,this.rect.attr("width",a),this)},_height:function(a){return 0===arguments.length?this.height:(this.height=a,this.rect.attr("height",a),this)},box:function(a,b){return 0===arguments.length?{width:this.width,height:this.height}:(this._width(a),1===arguments.length?this._height(a):this._height(b),this)},xy:function(a,b){return 0===arguments.length?{x:this.x,y:this.y}:(this.x=a,this.y=1===arguments.length?a:b,this.rect.attr({x:this.x,y:this.y}),this)}}),a.chart("Scale",{initialize:function(a){if(a=a||{},!a.info)throw new Error("Container Info {info: containerInfo} is absolultely required when an instance is created");var b=a.x||"linear",c=a.y||"linear";if(this._x=b,this._y=c,this.width=a.width||a.info.canvasW||this.base.attr("width")||1,this.width=+this.width,this.height=a.height||a.info.canvasH||this.base.attr("height")||1,this.height=+this.height,this.info=a.info,this.xScale=this._scale(b),this.yScale=this._scale(c),this._switchXScale(b,this.width),this._switchYScale(c,this.height,!1),a.y1){var d=a.y1||"linear";this.y1Scale=this._scale(d),this._switchYScale(d,this.height,!0)}},_switchXScale:function(a,b){switch(a){case"linear":this.xScale.range([0,b]);break;case"ordinal":this.xScale.rangeRoundBands([0,b],.1)}},_switchYScale:function(a,b,c){var d=c?this.y1Scale:this.yScale;switch(a){case"linear":d.range([b,15]);break;case"ordinal":d.rangeRoundBands([b,15],.1)}},_scale:function(b){switch(b){case"linear":return a.scale.linear();case"ordinal":return a.scale.ordinal();case"log":return a.scale.log();case"pow":return a.scale.pow();case"sqrt":return a.scale.sqrt();case"identity":return a.scale.identity();case"quantile":return a.scale.quantile();case"quantize":return a.scale.quantize();case"threshold":return a.scale.threshold();case"time":return a.time.scale();default:return a.scale.linear()}}}),a.chart("Scale").extend("Base",{initialize:function(b){b=b||{},this.box(this.width,this.height),this.dispatch=a.dispatch("d3maMouseenter","d3maMouseout","d3maOnWindowResize","d3maOffWindowResize","d3maSingleWindowResize")},w:function(a){return 0===arguments.length?this.width:(this.width=a,this.base.attr("width",this.width),this)},h:function(a){return 0===arguments.length?this.height:(this.height=a,this.base.attr("height",this.height),this)},box:function(a,b){return arguments.length?(this.w(a),this.h(b?b:a),this):{width:this.width,height:this.height}},_bindMouseEnterOutEvents:function(b,c){var b=b||this;c.on("mouseenter",function(d,e){a.select(this).classed("hover",!0);var f={};b.onDataMouseenter&&(f=b.onDataMouseenter(d,e,b,c[0][e])),b.dispatch.d3maMouseenter(f)}),c.on("mouseout",function(d,e){a.select(this).classed("hover",!1);var f={};b.onDataMouseout&&(f=b.onDataMouseout(d,e,b,c[0][e])),b.dispatch.d3maMouseout(f)})},_resize:function(){var b=this.info,c=a.ma.$$(b.parentNode);if(!c)return!1;var d=a.ma.windowSize(),e=c.getAttribute("data-fluid"),f=a.ma.responsive?c.offsetLeft:a.ma.$$(b.parentNode).offsetLeft+b.marginLeft+b.marginRight,g=a.ma.responsive?c.offsetTop:c.offsetTop+b.marginTop+b.marginBottom,h=d.width-f,i=d.height-g;if("responsive"===e){var j=b.containerW,k=c.clientWidth,l=b.containerH,m=c.clientHeight;if(k>j||m>l){var n="0 0 "+k+" "+m,o=c.children[0],p=a.ma.$$(b.id)||a.ma.$$("#summaryChart").children[0].children[1],q=a.ma.$$(b.cid+" rect")||a.ma.$$("#summaryChart").children[0].children[0].children[0].children[0];o.setAttribute("width",k),o.setAttribute("height",m),o.setAttribute("viewBox",n),p.setAttribute("width",k),p.setAttribute("height",m),q.setAttribute("width",k),q.setAttribute("height",m)}var r={width:k,height:i<b.containerH?i:b.containerH};this.dispatch.d3maOnWindowResize(r)}else if(h<b.containerW||i<b.containerH){var r={width:h<b.containerW?h:b.containerW,height:i<b.containerH?i:b.containerH};this.dispatch.d3maOnWindowResize(r)}else{var s={width:b.canvasW,height:b.canvasH},t={width:b.containerW,height:b.containerH};this.dispatch.d3maOnWindowResize(t),this.dispatch.d3maOffWindowResize(s)}},_unbindResize:function(){var a=this.info,b={width:a.canvasW,height:a.canvasH};this.dispatch.d3maOffWindowResize(b)},_onWindowResize:function(a,b){var c=this;this.dispatch.on("d3maOnWindowResize",function(d){c._redraw(d,a,b)}),this.dispatch.on("d3maOffWindowResize",function(d){c._unbind(d,a,b)})},_redraw:function(a,b,c){var d=this.info,e=a.width-d.marginLeft-d.marginRight,f=a.height-d.marginTop-d.marginBottom;this._updateScale(e,f),this.dispatch.d3maSingleWindowResize(b,c),this._update&&this._update(e,f,b,c),this.update&&this.update(e,f,b,c)},_unbind:function(a,b,c){var d=this.info,e=+this.base.attr("width"),f=+this.base.attr("height"),g=d.canvasW,h=d.canvasH;(e!==g||f!==h)&&(this._updateScale(g,h),this.update&&this.update(g,h,b,c))},_updateScale:function(a,b){this._switchXScale(this._x,a),this._switchYScale(this._y,b),this.box(a,b)}}),a.chart("Base").extend("Axis",{initialize:function(b){this.options=b=b||{},this.guide=b.guide||!1,this.ticksOnResize=b.ticksOnResize||!1,this.xAxis=a.svg.axis().scale(this.xScale).orient("bottom"),this.yAxis=a.svg.axis().scale(this.yScale).orient("left"),this.guide&&(this.xAxis.tickPadding(5).tickSize(-this.height,0,6),this.yAxis.tickPadding(5).tickSize(-this.width,0,6)),this.xAxisG=this.base.append("g"),this.xAxisG.attr({"class":"x axis"}),this.xPos(),this.yAxisG=this.base.append("g"),this.yAxisG.attr({"class":"y axis"}),this.yPos(null,!1),b.y1&&(this.y1Axis=a.svg.axis().scale(this.y1Scale).orient("right").tickPadding(5),this.y1AxisG=this.base.append("g"),this.y1AxisG.attr({"class":"y1 axis"}),this.yPos(this.width,!0))},transform:function(a){if(this.onDataBind&&this.onDataBind(a),this.xAxisG.transition().duration(400).ease("cubic-out").call(this.xAxis),this.yAxisG.transition().duration(400).ease("cubic-out").call(this.yAxis),this.options.y1){var b=+this.base.attr("width");this.yPos(b,!0),this.y1AxisG.transition().duration(400).ease("cubic-out").call(this.y1Axis)}return this._onWindowResize(this),a},xPos:function(a){var a=a?a:this.height;return this.xAxisG.attr({transform:"translate(0,"+a+")"}),this},yPos:function(a,b){if(a){var c=b?this.y1AxisG:this.yAxisG;c.attr({transform:"translate("+a+" , 0)"})}return this},_update:function(a,b,c){this.update&&this.update(a,b,c),this.ticksOnResize&&this._redrawTicksOnResize(),this.xAxisG.attr({transform:"translate(0,"+b+")"}),this.guide&&(this.xAxis.tickSize(-this.height,0,6),this.yAxis.tickSize(-this.width,0,6)),this.xAxisG.transition().duration(400).ease("cubic-out").call(this.xAxis),this.yAxisG.transition().duration(400).ease("cubic-out").call(this.yAxis),this.options.y1&&this.y1AxisG.transition().duration(400).ease("cubic-out").call(this.y1Axis.orient("right"))},_redrawTicksOnResize:function(){var a=this.xScale.range(),b=this.yScale.range();"ordinal"!==this._x&&this.xAxis.ticks(Math.abs(a[1]-a[0])/100),"ordinal"!==this._y&&this.yAxis.ticks(Math.abs(b[1]-b[0])/100)},xLabel:function(a,b,c){var d=this.info,e=b+d.marginLeft,f=c-d.marginBottom;return this.xAxisG.append("text").classed("label",!0).attr({x:e||d.marginLeft-15,y:f||0,transform:"translate("+this.info.marginLeft+","+this.info.marginBottom+")"}).style("opacity",1e-6).text(a).transition().duration(1e3).ease("cubic-out").style("opacity",1),this},yLabel:function(a,b,c,d){this.info;var e=d?this.y1AxisG:this.yAxisG,f=d?c:-c,g=d?-270:-90;return e.append("text").classed("label",!0).attr({x:f||-15,y:b||15,transform:"rotate("+g+") translate("+-this.info.marginTop+","+-this.info.marginLeft+")"}).style("opacity",1e-6).text(a).transition().duration(800).ease("cubic-out").style("opacity",1),this}}),a.chart("Base").extend("Bars",{initialize:function(a){this.options=a=a||{};var b=this;this.barsGroup=this.base.selectAll(".group"),this.layer("bars",this.barsGroup,{dataBind:function(a){var b=this.chart();return b.onDataBind&&b.onDataBind(a,b),b.rectsGroup?b.rectsGroup.data(a):this.data(a)},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),a.rectsGroup||(a.rectsGroup=this.append("g").classed("group",!0).append("rect")),a.rectsGroup},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this)},"enter:transition":function(){var a=this.chart();a.onEnterTransition&&a.onEnterTransition(a,this)},merge:function(){var a=this.chart();a.onMerge&&a.onMerge(a,this),a._onWindowResize(a,this),b._bindMouseEnterOutEvents(a,this)},"exit:transition":function(){this.chart(),this.duration(400).ease("cubic-in").style("opacity",1e-6).remove()}}})}}),a.chart("Base").extend("Line",{initialize:function(b){this.options=b=b||{},this.linePath=this.base.append("svg:path").classed("line",!0),this.line=a.svg.line(),this.layer("line",this.linePath,{dataBind:function(a){var b=this.chart();return b.dispatch.on("d3maSingleWindowResize",function(a,b){b.attr({d:a.line})}),b.line.x(function(a){return b.xScale(a.x)}).y(function(a){return b.yScale(a.y)}),b.onDataBind&&b.onDataBind(a,b),this.data([a])},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),a.linePath},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this)},"enter:transition":function(){var a=this.chart();this.duration(700).ease("cubic-out").attr({d:a.line})},merge:function(){var a=this.chart();a._onWindowResize(a,this)},"exit:transition":function(){this.chart(),this.duration(400).ease("cubic-in").style("opacity",1e-6).remove()}}})},_update:function(a,b,c){this.linePath.attr({d:c.line})}}),a.chart("Base").extend("Area",{initialize:function(b){this.options=b=b||{},this.areaPath=this.base.append("svg:path").classed("area",!0),this.area=a.svg.area(),this.layer("area",this.areaPath,{dataBind:function(a){var b=this.chart();return b.dispatch.on("d3maSingleWindowResize",function(a,b){b.attr({d:a.area})}),b.area.x(function(a){return b.xScale(a.x)}).y1(function(a){return b.yScale(a.y)}).y0(b.height),b.onDataBind&&b.onDataBind(a,b),this.data([a])},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),a.areaPath},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this)},"enter:transition":function(){var a=this.chart();this.duration(700).ease("cubic-out").attr({d:a.area})},merge:function(){var a=this.chart();a._onWindowResize(a,this)},"exit:transition":function(){this.chart(),this.duration(400).ease("cubic-in").style("opacity",1e-6).remove()}}})},_update:function(a,b,c,d){this.update&&this.update(a,b,c,d),this.areaPath.attr({d:c.area})}}),a.chart("Base").extend("Circle",{initialize:function(a){this.options=a=a||{};var b=this,c=a.showOnHover||!1;this.layer("circle",this.base,{dataBind:function(a){var b=this.chart();return b.onDataBind&&b.onDataBind(a,b),this.classed("dotHover",c?!0:!1).selectAll("circle").data(a)},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),this.append("circle")},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this)},merge:function(){var a=this.chart();a._onWindowResize(a,this),b._bindMouseEnterOutEvents(a,this)},"exit:transition":function(){this.chart(),this.duration(400).ease("cubic-in").style("opacity",1e-6).remove()}}})},_update:function(a,b,c,d){this.update&&this.update(a,b,c,d)}}),a.chart("Base").extend("SimpleLine",{initialize:function(a){this.options=a=a||{};var b=this;this.layer("simpleLine",this.base,{dataBind:function(a){var b=this.chart();return b.onDataBind&&b.onDataBind(a,b),this.classed("simple-lines",!0).selectAll("line").data(a)},insert:function(){var a=this.chart();return a.onInsert&&a.onInsert(a),this.append("line")},events:{enter:function(){var a=this.chart();a.onEnter&&a.onEnter(a,this)},merge:function(){var a=this.chart();a._onWindowResize(a,this),b._bindMouseEnterOutEvents(a,this)},"exit:transition":function(){this.chart(),this.duration(400).ease("cubic-in").style("opacity",1e-6).remove()}}})},_update:function(a,b,c,d){this.update&&this.update(a,b,c,d)}})}();