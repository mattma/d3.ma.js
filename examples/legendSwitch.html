<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>D3 Test</title>

	<link rel="stylesheet" type="text/css" href="../src/d3.ma.css">

	<script src="../libs/d3.v3.js"></script>
	<script src="../libs/d3.chart.js"></script>


	<script src="../src/common/core.js"></script>
	<script src="../src/common/utils.js"></script>
	<script src="../src/common/container.js"></script>
	<script src="../src/components/clippath.js"></script>


	<script src="../src/core/scale.js"></script>
	<script src="../src/core/base.js"></script>


	<script src="../src/components/axis.js"></script>
	<script src="../src/components/legend.js"></script>


	<script src="../src/basic/bars.js"></script>
	<script src="../src/basic/line.js"></script>
	<script src="../src/basic/circle.js"></script>
	<script src="../src/basic/area.js"></script>

<!--
	<script src="../build/d3.ma.min.js"></script>
-->

</head>
<body>
	<div id="vis"></div>

	<script>
		function sinAndCos() {
			var sin = [],
				cos = [];

			for (var i = 0; i < 100; i++) {
				sin.push({x: i, y: i % 10 == 5 ? null : Math.sin(i/10) }); //the nulls are to show how defined works
				cos.push({x: i, y: .5 * Math.cos(i/10)});
			}

			// return 	{
			// 	values: cos,
			// 	key: "Cosine Wave",
			// 	color: "#2ca02c"
			// };

			return [
				{
					area: true,
					values: sin,
					key: "Sine Wave",
					color: "#ff7f0e"
				},
				{
					values: cos,
					key: "Cosine Wave",
					color: "#2ca02c"
				}
			];
		}

		var data = sinAndCos();
	</script>

	<script>
		d3.chart('Line').extend('MyLine', {
			onDataBind: function(chart) {
				var chart = chart || this;
				//domain(chart);
			}
		});

		function domain(context) {

			var xMax = d3.extent(data.values, function(d){
				return d.x;
			});
			var yMax = d3.extent(data.values, function(d){
				return d.y;
			});

			// console.log('xMax: ', xMax);
			// console.log('yMax: ', yMax);
			//
			// Setup xScale & yScale domain range
			context.xScale.domain(xMax);
			context.yScale.domain([-1,1]);
		}

		d3.chart("FinalChart", {
			initialize: function(containerInfo) {

				var legend = this.mixin('Legend', this.base.append('g'), {
					info: containerInfo,
					align: false
				});

				// var line = this.mixin('MyLine', this.base.append('g'), {
				// 	info: containerInfo,
				// 	data: 'values'
				// });

				this.layer('layers', this.base, {
					dataBind: function(data) {
						var chart = this.chart();
						//console.log('data: ', data);
						return this.selectAll('.enter').data(data);
					},

					insert: function(){
						var chart = this.chart();
						return this.append('g').classed('enter', true);
					},

					events: {
						'enter': function() {
							var chart = this.chart();

							// two elements have two set of data
							//console.log('this: ', this);

							var self = this;
							this.each(function(_data){

								var line = chart.mixin('MyLine', self.append('g').classed('matt', true), {
									info: containerInfo,
									data: 'values',
									transform: _data
								});

							});

					 	// 	console.log('begin');
							// var line = chart.mixin('MyLine', matt.append('g').classed('mixin', true), {
							// 	info: containerInfo,
							// 	data: 'values'
							// });

							// this.attr({
							// 	'fill': function(d) {
							// 		console.log('d.key: ', d.key);
							// 	}
							// });

							// this.append('rect').attr({
							// 	'fill': function(d, i) {
							// 		console.log('d: ', d);
							// 	}
							// });
						}
					}
				});


				// legend.dispatch.on('d3maLegendMouseenter', function(d,i){
				// 	console.log(d);
				// });
				// legend.dispatch.on('d3maLegendMouseout', function(d,i){
				// 	console.log(i);
				// });
				// legend.dispatch.on('d3maLegendClick', function(d,i, chart, single){
				// 	console.log('d: ', d);
				// 	console.log('i: ', i);
				// 	console.log('chart: ', chart);
				// 	console.log('single: ', single);
				// });
			}

		});

		var container = d3.ma.container('#vis').margin({left: 50});

		container.box(1400, 600);  //.resize()

		var canvas = container.canvas().chart("FinalChart", container.info() );

		//render it with some data
		canvas.draw(data);

		//console.log('data: ', data);

	</script>

	<!-- livereload snippet  -->
	<script src="http://localhost:35729/livereload.js?snipver=1"></script>
</body>
</html>
